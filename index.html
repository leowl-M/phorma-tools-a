<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Phorma</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />
  </head>
  <body>
    <header class="topbar">
      <h1>Phorma</h1>
      <div class="spacer"></div>
      <button id="btnExportPNG" class="btn">Esporta PNG</button>
      <button id="btnExportPNGTrim" class="btn">PNG (ritagliato)</button>
      <button id="btnExportSVG" class="btn">Esporta SVG</button>
    </header>

    <div id="app">
      <aside id="sidebar">
        <div class="tabbar" role="tablist">
          <button
            type="button"
            class="tab active"
            role="tab"
            aria-selected="true"
            data-tab-target="typography"
          >
            Tipografia
          </button>
          <button
            type="button"
            class="tab"
            role="tab"
            aria-selected="false"
            data-tab-target="deformation"
          >
            Deformazioni
          </button>
          <button
            type="button"
            class="tab"
            role="tab"
            aria-selected="false"
            data-tab-target="effects"
          >
            Effetti
          </button>
        </div>

        <!-- TIPOGRAFIA -->
        <section class="panel" data-tab="typography">
          <h2>Font</h2>
          <div id="drop" class="dropzone">
            Trascina qui un .ttf/.otf/.woff/.woff2 o clicca
          </div>
          <input id="file" type="file" accept=".ttf,.otf,.woff,.woff2" hidden />
          <div class="row">
            <label for="localFont">Font salvati</label>
            <select id="localFont">
              <option value="">(Seleziona un font)</option>
            </select>
          </div>
          <div class="row">
            <label>Nome</label>
            <input id="fontName" type="text" placeholder="(dal font)" disabled />
          </div>
          <div class="row">
            <label>Stile</label>
            <input id="fontStyle" type="text" placeholder="(dal font)" disabled />
          </div>
          <div class="row">
            <label><input type="checkbox" id="useKerning" checked /> Kerning</label>
          </div>
          <div class="row">
            <label><input type="checkbox" id="autoHint" checked /> Auto hint</label>
          </div>
        </section>

        <section class="panel collapsed" data-tab="typography">
          <h2>Testo</h2>
          <div class="row">
            <label for="text">Contenuto (solo parole, MAIUSCOLO)</label>
            <textarea id="text">PHORMA</textarea>
          </div>
          <div class="row">
            <label>Dimensione</label>
            <input type="range" id="fontSize" min="24" max="640" value="140" />
            <span class="val" id="fontSizeVal">140</span>
          </div>
        </section>

        <!-- DEFORMAZIONI -->
        <section class="panel" data-tab="deformation">
          <h2>Distorsioni statiche</h2>

          <div class="control-group">
            <h3>Jitter</h3>
            <div class="row">
              <label>Jitter</label>
              <input type="range" id="jitter" min="0" max="19" step="1" value="1" disabled/>
              <span class="val" id="jitterVal">1</span>
            </div>
          </div>

          <div class="control-group">
            <h3>Contrasto calligrafico</h3>
            <div class="row">
              <label><input type="checkbox" id="fxContrast" checked /> Contrasto calligrafico</label>
            </div>
            <div class="row">
              <label>Intensità contrasto</label>
              <input type="range" id="contrastAmount" min="-100" max="100" step="1" value="0" />
              <span class="val" id="contrastAmountVal">0</span>
            </div>
            <div class="row">
              <label>Angolo penna</label>
              <input type="range" id="contrastAngle" min="0" max="365" step="1" value="1" disabled/>
              <span class="val" id="contrastAngleVal">1</span>
            </div>
            <!-- <div class="row">
              <label>Sharpness</label>
              <input type="range" id="contrastSharpness" min="0" max="1" step="0.01" value="0" />
              <span class="val" id="contrastSharpnessVal">0</span>
            </div> -->
            <div class="row">
              <label>Mix effetto</label>
              <input type="range" id="contrastMix" min="0" max="1.20" step="0.01" value="0.10" disabled/>
              <span class="val" id="contrastMixVal">0.10</span>
            </div>
            <!-- <div class="row">
              <label>Clamp contrasto</label>
              <input type="range" id="contrastClamp" min="0" max="1" step="0.01" value="1" />
              <span class="val" id="contrastClampVal">1</span>
            </div> -->
            <div class="row">
              <label>Balance</label>
              <input type="range" id="contrastBalance" min="-1" max="1" step="0.05" value="0" />
              <span class="val" id="contrastBalanceVal">0</span>
            </div>
          </div>

          <div class="control-group">
            <h3>Temporizzazione</h3>
            <div class="row">
              <label><input type="checkbox" id="timeDebugEnabled" /> Mostra debug temporizzazione</label>
            </div>
            <div id="timeDebugInfo" style="display: none; font-size: 11px; color: var(--muted); margin-top: 8px; padding: 8px; background: #f5f5f5; border: 1px solid var(--ink);">
              <div><strong>Data riferimento:</strong> <span id="debugRefDate">-</span></div>
              <div><strong>Giorni trascorsi:</strong> <span id="debugDays">-</span></div>
              <div><strong>Mesi trascorsi:</strong> <span id="debugMonths">-</span></div>
              <div><strong>Trimestri trascorsi:</strong> <span id="debugQuarters">-</span></div>
              <div style="margin-top: 8px; border-top: 1px solid var(--ink); padding-top: 8px;">
                <div><strong>Jitter:</strong> iniziale <span id="debugJitterInit">-</span> → attuale <span id="debugJitterCurrent">-</span> (+<span id="debugJitterInc">-</span>)</div>
                <div><strong>Angolo:</strong> iniziale <span id="debugAngleInit">-</span> → attuale <span id="debugAngleCurrent">-</span> (+<span id="debugAngleInc">-</span>)</div>
                <div><strong>Mix:</strong> iniziale <span id="debugMixInit">-</span> → attuale <span id="debugMixCurrent">-</span> (+<span id="debugMixInc">-</span>)</div>
              </div>
              <div style="margin-top: 8px;">
                <button type="button" id="btnResetTime" class="btn" style="width: 100%; font-size: 11px; padding: 4px 8px;">Reset temporizzazione</button>
                <button type="button" id="btnSimulateTime" class="btn" style="width: 100%; font-size: 11px; padding: 4px 8px; margin-top: 4px;">Simula +1 giorno</button>
              </div>
            </div>
          </div>
        </section>

        <!-- EFFETTI -->
        <section class="panel" data-tab="effects">
          <h2>Curvature Bitcrush</h2>
          <div class="row">
            <label><input type="checkbox" id="fxCurvCrush" checked /> Curvature Bitcrush</label>
          </div>
          <div class="row">
            <label>Segmenti / curva</label>
            <input type="range" id="curvSegments" min="1" max="24" step="1" value="8" disabled/>
            <span class="val" id="curvSegmentsVal">8</span>
          </div>
          <div class="row">
            <label>Angle-snap (°)</label>
            <input type="range" id="curvAngleSnap" min="0" max="90" step="1" value="90" disabled />
            <span class="val" id="curvAngleSnapVal">0</span>
          </div>
          <div class="row">
            <label>Tolleranza semplifica</label>
            <input type="range" id="curvTolerance" min="0" max="8" step="0.1" value="0" disabled/>
            <span class="val" id="curvToleranceVal">0</span>
          </div>
        </section>

        <section class="panel collapsed" data-tab="effects">
          <h2>Shape Mapping</h2>
          <div class="row">
            <label><input type="checkbox" id="fxShapeMap" /> Forma poligono</label>
          </div>
          <div class="row">
            <label>Lati</label>
            <input type="range" id="shapeSides" min="3" max="12" step="1" value="6" />
            <span class="val" id="shapeSidesVal">6</span>
          </div>
          <div class="row">
            <label>Raggio (× font)</label>
            <input type="range" id="shapeRadius" min="0.1" max="1.2" step="0.05" value="0.35" />
            <span class="val" id="shapeRadiusVal">0.35</span>
          </div>
          <div class="row">
            <label>Raggio interno (ratio)</label>
            <input type="range" id="shapeInner" min="0" max="1" step="0.01" value="0.4" />
            <span class="val" id="shapeInnerVal">0.4</span>
          </div>
          <div class="row">
            <label>Spaziatura (px)</label>
            <input type="range" id="shapeSpacing" min="4" max="80" step="1" value="22" />
            <span class="val" id="shapeSpacingVal">22</span>
          </div>
          <div class="row">
            <label>Twist (°)</label>
            <input type="range" id="shapeTwist" min="-180" max="180" step="1" value="0" />
            <span class="val" id="shapeTwistVal">0</span>
          </div>
          <div class="row">
            <label><input type="checkbox" id="shapeFollow" checked /> Segui tracciato</label>
          </div>
        </section>

        <section class="panel collapsed" data-tab="effects">
          <h2>Colore e Tratto</h2>
          <div class="row">
            <label>Riempimento</label>
            <input type="color" id="fillColor" value="#000000" />
          </div>
          <div class="row">
            <label>Tratto</label>
            <input type="color" id="strokeColor" value="#000000" />
          </div>
          <div class="row">
            <label>Spessore</label>
            <input type="range" id="strokeWeight" min="0" max="16" step="1" value="8" disabled />
            <span class="val" id="strokeWeightVal">8</span>
          </div>
          <div class="row">
            <label>Join</label>
            <select id="lineJoin">
              <option value="miter">Miter</option>
              <option value="round" selected>Round</option>
              <option value="bevel">Bevel</option>
            </select>
          </div>
          <div class="row">
            <label>Cap</label>
            <select id="lineCap">
              <option value="butt">Butt</option>
              <option value="round" selected>Round</option>
              <option value="square">Square</option>
            </select>
          </div>
        </section>
      </aside>

      <main id="stage">
        <div id="canvasWrap">
          <div id="canvasMount"></div>
        </div>
        <footer class="hintbar" id="hintbar">
          Doppio clic nell'area di anteprima per editare il testo • Rispetta le licenze dei font
        </footer>
      </main>
    </div>

    <!-- libs -->
    <script src="https://cdn.jsdelivr.net/npm/p5@1.9.2/lib/p5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/opentype.js@1.3.4/dist/opentype.min.js"></script>
    <script src="app.js"></script>
  </body>
</html>
